<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

    <!-- Rent Listings Template -->
    <t t-name="toolshub.RentListings">
        <div class="fade-in">
            <div class="page-header">
                <div style="display: flex; flex-direction: column; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="text-align: center;"><i class="fa fa-store" ></i> Rent Tools</h1>
                        <p>Browse and rent software tools from other users</p>
                    </div>
                    <button class="btn btn-primary btn-lg" t-on-click="openCreateModal">
                        <i class="fa fa-plus-circle"></i> Create Rent Listing
                    </button>
                </div>
            </div>

            <t t-if="state.loading">
                <div class="empty-state">
                    <i class="fa fa-spinner fa-spin"></i>
                    <h3>Loading listings...</h3>
                </div>
            </t>
            <t t-elif="state.listings.length === 0">
                <div class="empty-state">
                    <i class="fa fa-inbox"></i>
                    <h3>No listings available</h3>
                    <p>Be the first to create a rent listing!</p>
                    <button class="btn btn-primary btn-lg" t-on-click="openCreateModal">
                        <i class="fa fa-plus-circle"></i> Create Rent Listing
                    </button>
                </div>
            </t>
            <t t-else="">
                <div class="listings-grid">
                    <t t-foreach="state.listings" t-as="listing" t-key="listing.id">
                        <t t-if="(listing.is_active and !isFull(listing)) or listing.owner_id === props.user.id">
                            <ListingCard 
                                listing="listing"
                                type="'rentListing'"
                                currentUserId="props.user?.id"
                                onView.bind="viewListing"
                                onAction.bind="rentListing"
                                onToggleIsActive.bind="toggleIsActive"
                            />
                        </t>
                    </t>
                </div>
            </t>

            <!-- Get Connect ID -->
            <t t-if="state.showConnectIDModal">
                <div class="modal-overlay" t-on-click.self="closeConnectIDModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <i class="fa fa-plus-circle"></i>Stripe Connect Account ID
                            </h2>
                            <button class="modal-close" t-on-click="closeConnectIDModal">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>

                        <form class="modal-body" t-on-submit="handleConnectIDSubmit">

                            <!-- Input -->
                            <div class="form-group">
                                <label>Stripe Connect Account ID<span class="required">*</span></label>
                                <div class="input-group">
                                    <input 
                                        type="text"
                                        class="form-input"
                                        t-model="state.connectAccountID"
                                        required="required"
                                    />
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" t-on-click="closeCreateModal">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary" t-att-disabled="state.validatingConnectACcountID">
                                    <i class="fa fa-check"></i> Validate
                                </button>
                                <p style="color: var(--text-primary);">Don't have an account? </p>
                                <a href="#" class="auth-switch-link" t-on-click="createConnectAccount">
                                    Sign up here
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </t>
            
            <!-- Create Listing Modal -->
            <t t-if="state.showCreateModal">
                <div class="modal-overlay" t-on-click.self="closeCreateModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <i class="fa fa-plus-circle"></i> Create Rent Listing
                            </h2>
                            <button class="modal-close" t-on-click="closeCreateModal">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>

                        <form class="modal-body" t-on-submit="handleCreateListing">
                            <div class="form-group">
                                <label>Select Tool</label>
                                <select 
                                    class="form-input"
                                    t-model="state.newListing.tool_id"
                                    t-on-change="(ev) => this.updateField('tool_id', ev)"
                                    required="required"
                                >
                                    <t t-if="!state.newListing.tool_id">
                                        <option value="">Choose a tool...</option>
                                    </t>
                                    <t t-foreach="state.tools" t-as="tool" t-key="tool.id">
                                        <option t-att-value="tool.id">
                                            <t t-esc="tool.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Select Plan</label>
                                <select 
                                    class="form-input"
                                    t-model="state.newListing.plan_id"
                                    t-on-change="(ev) => this.updateField('plan_id', ev)"
                                    required="required"
                                    t-att-disabled="!selectedTool"
                                >
                                    <option value="">Choose a plan...</option>
                                    <t t-foreach="availablePlans" t-as="plan" t-key="plan.id">
                                        <option t-att-value="plan.id">
                                            <t t-esc="plan.name"/> - $<t t-esc="plan.price"/>/user
                                        </option>
                                    </t>
                                </select>
                            </div>

                            <!-- Price Input with Prefix -->
                            <div class="form-group">
                                <label>Price <span class="required">*</span></label>
                                <div class="input-group">
                                    <span class="input-prefix">$</span>
                                    <input 
                                        type="number"
                                        step="any"
                                        class="form-input no-spinner"
                                        placeholder="10.00"
                                        t-model="state.newListing.price"
                                        t-on-input="(ev) => this.updateField('price', ev)"
                                        required="required"
                                    />
                                </div>
                            </div>


                            <!-- Unlimited Users Toggle - Toggle Switch -->
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 0.5rem;">Unlimited Users</label>
                                <label class="toggle-switch">
                                    <input 
                                        type="checkbox"
                                        t-model="state.newListing.unlimited_users"
                                        t-on-change="onUnlimitedUsersChange"
                                    />
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <!-- Total Users (Conditional) -->
                            <div class="form-group conditional" t-att-class="{ 'hidden': state.newListing.unlimited_users }">
                                <label>Total Users <span class="required">*</span></label>
                                <input 
                                    type="number"
                                    class="form-input"
                                    placeholder="5"
                                    min="1"
                                    t-model="state.newListing.total_users"
                                    t-on-input="(ev) => this.updateField('total_users', ev)"
                                    t-att-disabled="state.newListing.unlimited_users"
                                    required="required"
                                />
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" t-on-click="closeCreateModal">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary" style="width:auto;" t-att-disabled="state.creating">
                                    <i class="fa fa-check"></i> Create Listing
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </t>

            <!-- Details Modal -->
            <t t-if="state.showDetailsModal and state.selectedListing">
                <div class="modal-overlay" t-on-click.self="closeDetailsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <t t-esc="state.selectedListing.tool_name"/>
                            </h2>
                            <button class="modal-close" t-on-click="closeDetailsModal">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>

                        <div class="modal-body">
                            <div class="listing-image" style="margin-bottom: 1.5rem; border-radius: 1rem; overflow: hidden;">
                                <t t-if="state.selectedListing.tool_img">
                                    <img t-att-src="state.selectedListing.tool_img_url" alt="image"/>
                                </t>
                            </div>

                            <div class="mb-3">
                                <span class="listing-plan-name">
                                    <t t-esc="state.selectedListing.plan_name"/>
                                </span>
                            </div>

                            <div class="listing-details mb-3">
                                <div class="listing-detail-item">
                                    <i class="fa fa-user"></i>
                                    <span>Owner: <strong><t t-esc="state.selectedListing.owner_name"/></strong></span>
                                </div>
                                <div class="listing-detail-item">
                                    <i class="fa fa-dollar-sign"></i>
                                    <span>Price: <strong>$<t t-esc="state.selectedListing.price"/></strong></span>
                                </div>
                                <div class="listing-detail-item">
                                    <i class="fa fa-users"></i>

                                    <t t-if="state.selectedListing.unlimited_users">
                                        <span>Unlimited Users</span>
                                    </t>
                                    <t t-else="">
                                        <span>
                                            <t t-esc="state.selectedListing.available_users"/> / <t t-esc="state.selectedListing.available_users + state.selectedListing.subscribers_count"/> slots available
                                        </span>
                                    </t>

                                </div>
                                <div class="listing-detail-item">
                                    <i class="fa fa-clock"></i>

                                    <t t-if="state.selectedListing.unlimited_access">
                                        <span>Unlimited Access</span>
                                    </t>
                                    <t t-else="">
                                        <span>
                                            <t t-if="state.selectedListing.duration_years"><t t-esc="state.selectedListing.duration_years"/> Years </t>
                                            <t t-if="state.selectedListing.duration_months"><t t-esc="state.selectedListing.duration_months"/> Months </t>
                                            <t t-if="state.selectedListing.duration_days"><t t-esc="state.selectedListing.duration_days"/> Days </t>
                                        </span>
                                    </t>
                                </div>
                            </div>
                            <div class="modal-subtitle">Features</div>
                            <div class="listing-features">
                                <t t-foreach="state.selectedListing.plan_features" t-as="feature" t-key="feature.id">
                                    <span class="listing-feature">
                                        <t t-esc="feature.name"/>
                                    </span>
                                </t>
                            </div>

                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-secondary" t-on-click="closeDetailsModal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </t>




        </div>
    </t>
</templates>